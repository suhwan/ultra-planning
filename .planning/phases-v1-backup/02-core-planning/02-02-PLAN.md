---
phase: 02-core-planning
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - .claude/agents/ultraplan-planner.md
autonomous: true

must_haves:
  truths:
    - "Planner can generate PROJECT.md from interview answers"
    - "Planner can generate ROADMAP.md with phase decomposition"
    - "Phase goals use outcome language, not task language"
    - "Dependencies form valid DAG structure"
  artifacts:
    - path: ".claude/agents/ultraplan-planner.md"
      provides: "Document generation logic for PROJECT and ROADMAP"
      contains: "PHASE 2: DOCUMENT GENERATION"
      min_lines: 300
  key_links:
    - from: ".claude/agents/ultraplan-planner.md"
      to: ".claude/skills/ultraplan/templates/project.md"
      via: "Template reference for PROJECT.md generation"
      pattern: "templates/project"
    - from: ".claude/agents/ultraplan-planner.md"
      to: ".claude/skills/ultraplan/templates/roadmap.md"
      via: "Template reference for ROADMAP.md generation"
      pattern: "templates/roadmap"
---

<objective>
Add PROJECT.md and ROADMAP.md generation logic to the Planner agent.

Purpose: Enable the Planner to transform interview answers into structured project documentation, following the Phase 1 templates.

Output: Extended `.claude/agents/ultraplan-planner.md` with document generation sections
</objective>

<execution_context>
@/home/ubuntu/.claude/get-shit-done/workflows/execute-plan.md
@/home/ubuntu/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-planning/02-RESEARCH.md
@.planning/phases/02-core-planning/02-01-SUMMARY.md
@.claude/skills/ultraplan/templates/project.md
@.claude/skills/ultraplan/templates/roadmap.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add PROJECT.md Generation Section</name>
  <files>.claude/agents/ultraplan-planner.md</files>
  <action>
Add document generation phase for PROJECT.md:

1. Generation Trigger:
- User says "make the plan", "create project", "generate documents"
- Interview deemed complete (core requirements captured)

2. PROJECT.md Generation Steps:
```markdown
## Step 1: Generate PROJECT.md

Using template from `.claude/skills/ultraplan/templates/project.md`:

1. Fill {project_name} from interview
2. Fill {one_paragraph_description} from stated goals
3. Derive {core_value_statement} - the ONE thing that matters most
4. Map requirements to Active section with REQ-XX IDs
5. List Out of Scope items with reasons
6. Fill {technical_context} from codebase scan or stated tech
7. Fill {constraints} from interview answers
8. Initialize Key Decisions table (all Pending)

Write to: `PROJECT.md` in project root
```

3. Core Value Derivation:
- Core value is NOT a feature list
- It's the ONE sentence that captures why this project matters
- Format: **{verb phrase}** — {constraint or qualifier}
- Example: **계획에서 실행까지 끊김 없이** — 문서 체계가 Claude Tasks와 동기화
  </action>
  <verify>
grep -c "PROJECT.md Generation" .claude/agents/ultraplan-planner.md
grep -c "core_value_statement" .claude/agents/ultraplan-planner.md
  </verify>
  <done>PROJECT.md generation section complete with field mapping and core value derivation</done>
</task>

<task type="auto">
  <name>Task 2: Add ROADMAP.md Generation Section</name>
  <files>.claude/agents/ultraplan-planner.md</files>
  <action>
Add ROADMAP.md generation logic:

1. Phase Decomposition Process:
```markdown
## Step 2: Generate ROADMAP.md

Using template from `.claude/skills/ultraplan/templates/roadmap.md`:

### Phase Decomposition Logic

1. State the end goal (outcome, not task)
2. Work BACKWARD: "What must be TRUE before this?"
3. Continue until reaching starting state
4. Reverse to get forward phase order

### For Each Phase:

1. **Goal**: Outcome from USER perspective (not task)
   - BAD: "Build authentication"
   - GOOD: "Users can log in and access protected features"

2. **Dependencies**: Which phases must complete first
   - Form a directed acyclic graph (DAG)
   - Mark critical path (longest dependency chain)

3. **Requirements**: Map to REQ-XX IDs from PROJECT.md

4. **Success Criteria**: Observable truths (3-5)
   - Must be verifiable by using the product
   - Not by reading code

5. **Plans**: Estimate count (2-3 tasks per plan, ~50% context)
   - Add placeholder list: "Plans: TBD (estimated N plans)"
```

2. Phase Numbering Rules:
- Integer phases: 1, 2, 3... for planned work
- Decimal phases: 2.5, 3.5... for urgent insertions
- Always leave room for insertions

3. Progress Table:
- Initialize all phases as "Not started"
- Plans column: 0/N where N is estimated

Write to: `ROADMAP.md` in project root
  </action>
  <verify>
grep -c "ROADMAP.md" .claude/agents/ultraplan-planner.md
grep -c "Phase Decomposition" .claude/agents/ultraplan-planner.md
grep -c "DAG" .claude/agents/ultraplan-planner.md
  </verify>
  <done>ROADMAP.md generation complete with goal-backward decomposition and DAG validation</done>
</task>

<task type="auto">
  <name>Task 3: Add STATE.md Initialization Section</name>
  <files>.claude/agents/ultraplan-planner.md</files>
  <action>
Add STATE.md initialization:

1. STATE.md Generation:
```markdown
## Step 3: Initialize STATE.md

Using template from `.claude/skills/ultraplan/templates/state.md`:

1. Set phase to 1 (first phase)
2. Set plan to 0 (no plans executed yet)
3. Set status to "Ready to plan"
4. Initialize progress bar at 0%
5. Record project reference to PROJECT.md
6. Initialize empty sections for:
   - Performance metrics
   - Accumulated context (decisions, todos, blockers)
   - Session continuity

Write to: `STATE.md` in project root
```

2. Directory Structure:
- Create `.ultraplan/` if not exists
- Create `.ultraplan/config.json` with defaults:
  ```json
  {
    "version": "1.0.0",
    "mode": "interactive",
    "depth": "standard",
    "parallelization": { "max_workers": 5 }
  }
  ```
- Create `.ultraplan/state/` and `.ultraplan/logs/` directories
  </action>
  <verify>
grep -c "STATE.md" .claude/agents/ultraplan-planner.md
grep -c "Initialize" .claude/agents/ultraplan-planner.md
  </verify>
  <done>STATE.md initialization section and directory structure creation added</done>
</task>

</tasks>

<verification>
1. PROJECT.md generation section exists: `grep "PROJECT.md Generation" .claude/agents/ultraplan-planner.md`
2. ROADMAP.md generation section exists: `grep "ROADMAP.md" .claude/agents/ultraplan-planner.md`
3. Goal-backward methodology referenced: `grep -c "BACKWARD\|backward" .claude/agents/ultraplan-planner.md`
4. Template references included: `grep -c "templates/" .claude/agents/ultraplan-planner.md`
5. STATE.md initialization: `grep "Initialize STATE" .claude/agents/ultraplan-planner.md`
6. File length check: `wc -l .claude/agents/ultraplan-planner.md` (should be >= 300)
</verification>

<success_criteria>
- [ ] PROJECT.md generation with all field mappings
- [ ] Core value derivation logic documented
- [ ] ROADMAP.md generation with phase decomposition
- [ ] Goal-backward methodology applied
- [ ] Phase goals use outcome language (user perspective)
- [ ] Dependency DAG validation mentioned
- [ ] STATE.md initialization section
- [ ] Directory structure creation documented
- [ ] References to Phase 1 templates
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-planning/02-02-SUMMARY.md`
</output>
