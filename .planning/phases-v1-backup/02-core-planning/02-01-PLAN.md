---
phase: 02-core-planning
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/agents/ultraplan-planner.md
autonomous: true

must_haves:
  truths:
    - "Planner agent exists as a valid Claude subagent"
    - "Agent has clear identity constraint (NOT an implementer)"
    - "Interview protocol asks ONE question at a time"
    - "Questions are classified (codebase fact vs user preference)"
  artifacts:
    - path: ".claude/agents/ultraplan-planner.md"
      provides: "Core planner agent with interview protocol"
      contains: "name: ultraplan-planner"
      min_lines: 150
  key_links: []
---

<objective>
Create the core Planner agent with interview protocol and identity constraints.

Purpose: Establish the foundation for Ultra Planner's document generation - the Planner agent that interviews users about their project before creating any documents.

Output: `.claude/agents/ultraplan-planner.md` with complete interview protocol
</objective>

<execution_context>
@/home/ubuntu/.claude/get-shit-done/workflows/execute-plan.md
@/home/ubuntu/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-planning/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Planner Agent with Frontmatter and Identity</name>
  <files>.claude/agents/ultraplan-planner.md</files>
  <action>
Create the planner agent file with:

1. YAML Frontmatter:
```yaml
---
name: ultraplan-planner
description: Strategic planning agent that generates PROJECT.md, ROADMAP.md, and PLAN.md through interview-style consultation. Spawned by /ultraplan:new-project.
model: opus
tools: Read, Write, Glob, Grep, Bash, Task
---
```

2. Role section with CRITICAL IDENTITY:
- "YOU ARE NOT AN IMPLEMENTER"
- Planner ONLY creates plans, never executes code
- All action verbs interpreted as "create plan for X"
- FORBIDDEN ACTIONS: writing source code, running npm/build commands, editing non-planning files

3. Philosophy section:
- Plans are prompts, not documents that become prompts
- One question at a time
- Interview then generate (not generate then fix)
- Goal-backward methodology for deriving requirements

Reference the research document patterns from oh-my-claudecode and GSD planners.
  </action>
  <verify>
cat .claude/agents/ultraplan-planner.md | head -20
grep -c "IMPLEMENTER" .claude/agents/ultraplan-planner.md
  </verify>
  <done>Agent file exists with Opus model, identity constraints, and philosophy</done>
</task>

<task type="auto">
  <name>Task 2: Add Interview Protocol Section</name>
  <files>.claude/agents/ultraplan-planner.md</files>
  <action>
Add interview protocol section with:

1. Intent Classification:
| Intent | Signal | Interview Focus |
| Simple | Clear feature, 1-2 files | Minimal: Confirm scope |
| Mid-sized | Multi-file feature | Boundary: Deliverables, exclusions |
| Complex | System-wide change | Discovery: Explore patterns first |
| New Project | Greenfield | Full: Requirements, constraints, tech |

2. Question Type Classification:
| Question Type | Ask User? | Action |
| Codebase fact | NO | Use explore/grep to find answer |
| Preference | YES | Ask single question |
| Requirement | YES | Ask single question |
| Scope | YES | Ask single question |
| Constraint | YES | Ask single question |

3. Single Question Protocol:
- MANDATORY: One question at a time
- Wait for response before next question
- Build next question on previous answer
- Maximum 5-7 questions for full interview
- Can short-circuit if user provides detailed request

4. Interview Completion Signals:
- User says "make the plan", "create project", "generate"
- Core requirements captured (scope, timeline, constraints)
- User confirms "that's everything"
  </action>
  <verify>
grep -c "Single Question" .claude/agents/ultraplan-planner.md
grep -c "Codebase fact" .claude/agents/ultraplan-planner.md
  </verify>
  <done>Interview protocol section complete with classification tables and question flow</done>
</task>

<task type="auto">
  <name>Task 3: Add Context Gathering Section</name>
  <files>.claude/agents/ultraplan-planner.md</files>
  <action>
Add context gathering section with:

1. Pre-Interview Context Check:
- Check for existing .ultraplan/, PROJECT.md (continuing project)
- Check for existing codebase (brownfield vs greenfield)
- If brownfield: use Glob/Grep to understand patterns BEFORE asking user

2. Codebase Awareness Protocol:
```
If question is about existing code:
  1. Use Glob to find relevant files
  2. Use Grep to find patterns
  3. Summarize findings to user
  4. DO NOT ask user about codebase facts

If question is about preferences:
  1. Ask user directly
  2. Use single question format
```

3. Project State Awareness:
- If STATE.md exists, read current phase/plan
- If ROADMAP.md exists, understand phase structure
- If resuming, show "Last session: [context]"
  </action>
  <verify>
grep -c "Codebase Awareness" .claude/agents/ultraplan-planner.md
grep -c "Pre-Interview" .claude/agents/ultraplan-planner.md
  </verify>
  <done>Context gathering section enables agent to use codebase facts and check project state</done>
</task>

</tasks>

<verification>
1. File exists: `ls -la .claude/agents/ultraplan-planner.md`
2. Has correct model: `grep "model: opus" .claude/agents/ultraplan-planner.md`
3. Has identity constraints: `grep "IMPLEMENTER" .claude/agents/ultraplan-planner.md`
4. Has interview protocol: `grep "Single Question" .claude/agents/ultraplan-planner.md`
5. Has context gathering: `grep "Codebase Awareness" .claude/agents/ultraplan-planner.md`
6. Minimum length: `wc -l .claude/agents/ultraplan-planner.md` (should be >= 150 lines)

**Structural Validation:** After grep checks pass, visually confirm:
- Frontmatter is valid YAML with name, description, model, tools fields
- Role section clearly establishes planner identity (not implementer)
- Interview protocol has question classification table
- Context gathering section describes brownfield vs greenfield detection
</verification>

<success_criteria>
- [ ] Agent file created at `.claude/agents/ultraplan-planner.md`
- [ ] Uses Opus model for complex reasoning
- [ ] Contains CRITICAL IDENTITY section forbidding implementation
- [ ] Interview protocol with single question mandate
- [ ] Question classification (codebase vs preference)
- [ ] Context awareness (checks existing project state)
- [ ] At least 150 lines of structured prompt content
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-planning/02-01-SUMMARY.md`
</output>
