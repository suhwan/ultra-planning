---
phase: 03-gsd-integration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/agents/types.ts
  - src/agents/prompts/planner.ts
  - src/agents/index.ts
autonomous: true

must_haves:
  truths:
    - "Planner agent prompt can be retrieved as typed object"
    - "Prompt includes all GSD planner sections (role, philosophy, task_breakdown, etc.)"
    - "Agent configuration includes tools, model hints, metadata"
  artifacts:
    - path: "src/agents/types.ts"
      provides: "Agent configuration types"
      exports: ["AgentConfig", "AgentPrompt", "AgentRole"]
      min_lines: 40
    - path: "src/agents/prompts/planner.ts"
      provides: "Planner agent prompt definition"
      exports: ["PLANNER_PROMPT", "getPlannerPrompt"]
      min_lines: 150
    - path: "src/agents/index.ts"
      provides: "Agents module exports"
      min_lines: 10
  key_links:
    - from: "src/agents/prompts/planner.ts"
      to: "src/agents/types.ts"
      via: "import AgentPrompt type"
      pattern: "import.*AgentPrompt"
---

<objective>
Create the Planner agent prompt management module.

Purpose: Store planner agent prompt as TypeScript for type safety and programmatic access, enabling dynamic prompt composition during planning workflows.
Output: Typed agent prompt with full GSD planner methodology embedded.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Reference planner prompt (GSD original)
@references/get-shit-done/agents/gsd-planner.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create agent configuration types</name>
  <files>src/agents/types.ts</files>
  <action>
Create src/agents/types.ts with:

```typescript
/** Agent role identifiers */
export type AgentRole = 'planner' | 'executor' | 'architect' | 'critic';

/** Agent metadata for spawning */
export interface AgentConfig {
  name: string;
  description: string;
  role: AgentRole;
  tools: string[];
  suggestedModel?: 'opus' | 'sonnet' | 'haiku';
  color?: string;
}

/** Structured agent prompt */
export interface AgentPrompt {
  config: AgentConfig;
  sections: AgentPromptSection[];
  getFullPrompt(): string;
}

/** Named section within agent prompt */
export interface AgentPromptSection {
  name: string;
  tag: string;  // XML tag name (e.g., 'role', 'philosophy')
  content: string;
}
```

Keep types minimal but extensible for future agents (executor, architect, critic in Phase 4).
  </action>
  <verify>npx tsc --noEmit src/agents/types.ts</verify>
  <done>Types compile, provide clear structure for agent prompts</done>
</task>

<task type="auto">
  <name>Task 2: Implement planner agent prompt</name>
  <files>src/agents/prompts/planner.ts</files>
  <action>
Create src/agents/prompts/planner.ts:

1. Import AgentPrompt, AgentPromptSection from ../types.ts

2. Define PLANNER_SECTIONS as array of AgentPromptSection:
   - role: Core responsibilities (from gsd-planner.md)
   - philosophy: Solo dev workflow, plans are prompts, quality curve, ship fast
   - task_breakdown: Task anatomy, types, sizing, specificity
   - dependency_graph: Needs/creates, wave assignment
   - goal_backward: Must-haves derivation methodology
   - plan_format: PLAN.md template structure

3. Create PLANNER_CONFIG: AgentConfig with:
   - name: 'gsd-planner'
   - description: 'Creates executable phase plans with task breakdown...'
   - role: 'planner'
   - tools: ['Read', 'Write', 'Bash', 'Glob', 'Grep']
   - suggestedModel: 'opus'
   - color: 'green'

4. Export PLANNER_PROMPT: AgentPrompt object with getFullPrompt() that combines sections into XML-wrapped string.

5. Export getPlannerPrompt(options?: { sections?: string[] }): string for selective section retrieval.

Adapt content from references/get-shit-done/agents/gsd-planner.md - extract key sections, preserve methodology, remove GSD-specific paths.
  </action>
  <verify>npx tsc --noEmit src/agents/prompts/planner.ts</verify>
  <done>Planner prompt exports correctly, getFullPrompt() returns complete methodology</done>
</task>

<task type="auto">
  <name>Task 3: Create agents module index</name>
  <files>src/agents/index.ts, src/index.ts</files>
  <action>
Create src/agents/index.ts:
- Re-export all types from ./types.js
- Re-export PLANNER_PROMPT, getPlannerPrompt from ./prompts/planner.js

Update src/index.ts:
- Add: export * from './agents/index.js';

Use .js extensions for ESM compatibility.
  </action>
  <verify>npx tsc --noEmit && node --loader ts-node/esm -e "import { PLANNER_PROMPT } from './src/index.js'; console.log(PLANNER_PROMPT.config.name)"</verify>
  <done>Agents module exports accessible from main entry point</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] PLANNER_PROMPT.getFullPrompt() returns valid prompt string
- [ ] getPlannerPrompt() returns selective sections
- [ ] All exports accessible from src/index.ts
</verification>

<success_criteria>
- All tasks completed
- Planner agent prompt captures GSD methodology
- Types support future agent additions
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-gsd-integration/03-02-SUMMARY.md`
</output>
