---
phase: 01-project-structure
plan: 03
type: execute
wave: 3
depends_on: ["01-02"]
files_modified:
  - src/types.ts
  - src/index.ts
autonomous: true

must_haves:
  truths:
    - "Core types are defined and exported"
    - "npm run build succeeds with types"
    - "Type declarations are generated in dist/"
  artifacts:
    - path: "src/types.ts"
      provides: "Core type definitions for Ultra Planner"
      exports: ["ExecutionMode", "PlanStatus", "PlanFrontmatter", "SessionState", "ProjectConfig"]
      min_lines: 80
    - path: "dist/types.d.ts"
      provides: "Generated type declarations"
  key_links:
    - from: "src/index.ts"
      to: "src/types.ts"
      via: "re-exports all types"
      pattern: "export \\* from './types"
---

<objective>
Create the core type definitions (src/types.ts) that will be used throughout Ultra Planner.

Purpose: Establish the type contracts for execution modes, plan state, session state, and project configuration. These types follow the GSD goal-backward methodology and OMC mode-registry patterns.

Output: src/types.ts with all core types, src/index.ts updated to re-export types, npm run build succeeds with type declarations.
</objective>

<execution_context>
@/home/ubuntu/.claude/get-shit-done/workflows/execute-plan.md
@/home/ubuntu/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-project-structure/01-RESEARCH.md
@.planning/phases/01-project-structure/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create src/types.ts with core type definitions</name>
  <files>src/types.ts</files>
  <action>
Create src/types.ts with the following type definitions.
Use the exact template from 01-RESEARCH.md "Core Types Template" section:

```typescript
/**
 * Ultra Planner Core Types
 *
 * Type definitions for the orchestration system.
 * Based on patterns from oh-my-claudecode mode-registry.
 */

// ============================================================================
// Execution Modes
// ============================================================================

/** Execution mode states */
export type ExecutionMode =
  | 'idle'
  | 'planning'
  | 'executing'
  | 'verifying'
  | 'paused'
  | 'error';

// ============================================================================
// Plan Types
// ============================================================================

/** Plan status values */
export type PlanStatus = 'pending' | 'in_progress' | 'completed' | 'failed';

/** PLAN.md frontmatter schema */
export interface PlanFrontmatter {
  phase: string;
  plan: number;
  type: 'execute' | 'tdd';
  wave: number;
  depends_on: string[];
  files_modified: string[];
  autonomous: boolean;
  must_haves: MustHaves;
}

/** Verification requirements */
export interface MustHaves {
  truths: string[];
  artifacts: Artifact[];
  key_links?: KeyLink[];
}

export interface Artifact {
  path: string;
  provides: string;
  contains?: string;
  exports?: string[];
  min_lines?: number;
}

export interface KeyLink {
  from: string;
  to: string;
  via: string;
  pattern?: string;
}

// ============================================================================
// State Types
// ============================================================================

/** Session state for .ultraplan/state/session.json */
export interface SessionState {
  active_plan: string | null;
  started_at: string;
  session_id: string;
  phase: string;
  plan: number;
  mode: ExecutionMode;
}

/** Project config for .ultraplan/config.json */
export interface ProjectConfig {
  version: string;
  mode: 'interactive' | 'autopilot';
  depth: 'quick' | 'standard' | 'comprehensive';
  parallelization: boolean;
  max_workers: number;
  commit_docs: boolean;
  model_profile: 'quality' | 'balanced' | 'budget';
}

// ============================================================================
// Progress Types
// ============================================================================

/** Progress tracking */
export interface PlanProgress {
  total: number;
  completed: number;
  is_complete: boolean;
}

export interface PhaseProgress {
  phase: string;
  plans_total: number;
  plans_completed: number;
  status: 'not_started' | 'in_progress' | 'completed';
}

export interface ProjectProgress {
  phases: PhaseProgress[];
  overall_percentage: number;
}
```
  </action>
  <verify>cat src/types.ts && grep -c "export" src/types.ts</verify>
  <done>src/types.ts exists with all core types exported (ExecutionMode, PlanStatus, PlanFrontmatter, SessionState, ProjectConfig, etc.)</done>
</task>

<task type="auto">
  <name>Task 2: Update src/index.ts to re-export types</name>
  <files>src/index.ts</files>
  <action>
Update src/index.ts to re-export all types from types.ts:

```typescript
/**
 * Ultra Planner - Document-driven workflow orchestration
 *
 * Entry point for the ultra-planner package.
 * Re-exports all public types and utilities.
 */

// Core types
export * from './types.js';

// Package version
export const VERSION = '0.1.0';
```

IMPORTANT: The import uses `.js` extension per NodeNext resolution requirements.
TypeScript will resolve this to types.ts during compilation but the output
JavaScript needs the .js extension.
  </action>
  <verify>cat src/index.ts && grep "export \* from './types.js'" src/index.ts</verify>
  <done>src/index.ts re-exports all types from types.ts using .js extension</done>
</task>

<task type="auto">
  <name>Task 3: Verify build and type declarations</name>
  <files>dist/types.js, dist/types.d.ts, dist/index.js, dist/index.d.ts</files>
  <action>
Run the full build and verify type declarations are generated:

```bash
# Clean previous build
rm -rf dist/

# Build
npm run build

# Verify outputs
ls -la dist/

# Check type declarations contain expected exports
grep "ExecutionMode" dist/types.d.ts
grep "PlanFrontmatter" dist/types.d.ts
grep "SessionState" dist/types.d.ts
```

Expected files in dist/:
- index.js, index.d.ts, index.js.map, index.d.ts.map
- types.js, types.d.ts, types.js.map, types.d.ts.map
  </action>
  <verify>npm run build && ls dist/*.d.ts && grep "ExecutionMode" dist/types.d.ts && echo "Types OK"</verify>
  <done>npm run build succeeds, dist/types.d.ts contains all exported types</done>
</task>

</tasks>

<verification>
Run the following commands to verify Phase 1 Plan 03 is complete:

```bash
# Verify types.ts exists and has exports
test -f src/types.ts && echo "src/types.ts OK"
grep -q "export type ExecutionMode" src/types.ts && echo "ExecutionMode OK"
grep -q "export interface PlanFrontmatter" src/types.ts && echo "PlanFrontmatter OK"
grep -q "export interface SessionState" src/types.ts && echo "SessionState OK"

# Verify index.ts re-exports
grep -q "export \* from './types.js'" src/index.ts && echo "Re-export OK"

# Verify build
npm run build && echo "Build OK"

# Verify type declarations
test -f dist/types.d.ts && grep -q "ExecutionMode" dist/types.d.ts && echo "Declarations OK"
```
</verification>

<success_criteria>
- [ ] src/types.ts exists with core type definitions
- [ ] ExecutionMode, PlanStatus, PlanFrontmatter, SessionState, ProjectConfig types are exported
- [ ] MustHaves, Artifact, KeyLink types are exported
- [ ] PlanProgress, PhaseProgress, ProjectProgress types are exported
- [ ] src/index.ts re-exports all types from types.ts
- [ ] npm run build succeeds
- [ ] dist/types.d.ts contains all type declarations
</success_criteria>

<output>
After completion, create `.planning/phases/01-project-structure/01-03-SUMMARY.md`
</output>
