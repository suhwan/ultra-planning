---
phase: 01-foundation
plan: 04
type: execute
wave: 2
depends_on: ["01-02"]
files_modified:
  - .claude/skills/ultraplan/references/schemas.md
autonomous: true

must_haves:
  truths:
    - "YAML frontmatter schema is documented with all required fields"
    - "XML task structure schema is documented with all elements"
    - "Examples show correct usage of both formats"
  artifacts:
    - path: ".claude/skills/ultraplan/references/schemas.md"
      provides: "YAML frontmatter and XML task schemas"
      contains: "## YAML Frontmatter Schema"
  key_links:
    - from: ".claude/skills/ultraplan/references/schemas.md"
      to: ".claude/skills/ultraplan/templates/plan.md"
      via: "Schema defines frontmatter fields used in template"
      pattern: "phase:|wave:|depends_on:"
---

<objective>
Document the YAML frontmatter and XML task structure schemas for PLAN.md.

Purpose: Schemas ensure consistency across all planning documents and enable validation. They define the contract between document authors (Planner agent) and consumers (Executor agent).

Output: schemas.md reference document with both YAML and XML schemas.
</objective>

<context>
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-02-SUMMARY.md

Key patterns from research:
- YAML frontmatter provides machine-readable metadata
- XML tags for task structure (trained in Claude's prompts)
- Schemas enable validation and tooling
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create schemas reference document</name>
  <files>.claude/skills/ultraplan/references/schemas.md</files>
  <action>
    Create `.claude/skills/ultraplan/references/schemas.md`:

    ```markdown
    # Ultra Planner Schemas

    ## YAML Frontmatter Schema

    PLAN.md frontmatter fields:

    ### Required Fields

    | Field | Type | Description | Example |
    |-------|------|-------------|---------|
    | phase | string | Phase identifier | "01-foundation" |
    | plan | integer | Plan number within phase | 1, 2, 3 |
    | type | enum | Plan type | "execute" or "tdd" |
    | wave | integer | Execution wave (1, 2, 3...) | 1 |
    | depends_on | array | Plan IDs this plan requires | ["01-01", "01-02"] |
    | files_modified | array | Files this plan touches | [".ultraplan/config.json"] |
    | autonomous | boolean | true if no checkpoints | true |

    ### Optional Fields

    | Field | Type | Description | Default |
    |-------|------|-------------|---------|
    | user_setup | array | Human-required setup | [] |
    | gap_closure | boolean | Is this a gap closure plan | false |

    ### must_haves Block (Required)

    ```yaml
    must_haves:
      truths:
        - "Observable behavior 1"
        - "Observable behavior 2"
      artifacts:
        - path: "path/to/file.ext"
          provides: "What this artifact provides"
          contains: "Pattern or text that must exist"
          exports: ["optional", "exported", "symbols"]
          min_lines: 30  # optional minimum line count
      key_links:
        - from: "source/file.ext"
          to: "target/file.ext"
          via: "Connection description"
          pattern: "regex pattern to verify"
    ```

    ### Example Frontmatter

    ```yaml
    ---
    phase: 01-foundation
    plan: 01
    type: execute
    wave: 1
    depends_on: []
    files_modified:
      - .ultraplan/config.json
      - .ultraplan/state/.gitkeep
    autonomous: true

    must_haves:
      truths:
        - ".ultraplan/ directory exists"
        - "config.json is valid JSON"
      artifacts:
        - path: ".ultraplan/config.json"
          provides: "Project configuration"
          contains: '"version"'
      key_links: []
    ---
    ```

    ## XML Task Structure Schema

    Tasks are defined within `<tasks>` container using `<task>` elements.

    ### Task Element

    ```xml
    <task type="{task_type}">
      <name>{action_oriented_name}</name>
      <files>{file_paths}</files>
      <action>{specific_implementation}</action>
      <verify>{verification_command}</verify>
      <done>{acceptance_criteria}</done>
    </task>
    ```

    ### Task Types

    | Type | Description | Autonomy |
    |------|-------------|----------|
    | auto | Claude executes independently | Fully autonomous |
    | checkpoint:human-verify | Human confirms automated work | Pauses for user |
    | checkpoint:decision | Human makes implementation choice | Pauses for user |
    | checkpoint:human-action | Truly unavoidable manual steps | Pauses for user |

    ### Required Elements (type="auto")

    | Element | Description | Example |
    |---------|-------------|---------|
    | name | Action-oriented task name | "Task 1: Create config file" |
    | files | File paths created/modified | ".ultraplan/config.json" |
    | action | Specific implementation steps | "Create JSON file with..." |
    | verify | Command to prove completion | "cat file.json \| jq ." |
    | done | Acceptance criteria | "File exists with valid JSON" |

    ### Checkpoint Elements (type="checkpoint:*")

    ```xml
    <task type="checkpoint:human-verify" gate="blocking">
      <what-built>{what_claude_automated}</what-built>
      <how-to-verify>{exact_steps_to_test}</how-to-verify>
      <resume-signal>Type "approved" or describe issues</resume-signal>
    </task>

    <task type="checkpoint:decision" gate="blocking">
      <decision>{what_is_being_decided}</decision>
      <context>{why_this_matters}</context>
      <options>
        <option id="option-a">
          <name>{option_name}</name>
          <pros>{benefits}</pros>
          <cons>{tradeoffs}</cons>
        </option>
      </options>
      <resume-signal>Select: option-a, option-b, or ...</resume-signal>
    </task>
    ```

    ### Full Example

    ```xml
    <tasks>

    <task type="auto">
      <name>Task 1: Create directory structure</name>
      <files>
        .ultraplan/
        .ultraplan/config.json
      </files>
      <action>
        Create .ultraplan/ directory with config.json containing:
        - version: "1.0.0"
        - mode: "interactive"
        Use JSON format for machine readability.
      </action>
      <verify>ls -la .ultraplan/ && cat .ultraplan/config.json | jq .</verify>
      <done>Directory exists, config.json parses as valid JSON</done>
    </task>

    <task type="checkpoint:human-verify" gate="blocking">
      <what-built>Configuration file structure</what-built>
      <how-to-verify>
        1. Run: cat .ultraplan/config.json
        2. Verify version is "1.0.0"
        3. Verify mode is "interactive"
      </how-to-verify>
      <resume-signal>Type "approved" or describe issues</resume-signal>
    </task>

    </tasks>
    ```

    ## Validation Rules

    1. **Frontmatter must start and end with `---`**
    2. **All required fields must be present**
    3. **wave must be >= 1**
    4. **depends_on must only reference plans with lower wave numbers**
    5. **files_modified should not overlap with parallel plans in same wave**
    6. **Each task must have all required elements for its type**
    7. **Task names should start with "Task N:"**
    ```
  </action>
  <verify>cat .claude/skills/ultraplan/references/schemas.md | grep -E "## YAML Frontmatter|## XML Task Structure|### Task Types"</verify>
  <done>schemas.md exists with YAML frontmatter schema, XML task schema, task types, and validation rules</done>
</task>

</tasks>

<verification>
1. Schema file exists: `ls .claude/skills/ultraplan/references/schemas.md`
2. YAML schema documented: `grep "## YAML Frontmatter" .claude/skills/ultraplan/references/schemas.md`
3. XML schema documented: `grep "## XML Task Structure" .claude/skills/ultraplan/references/schemas.md`
4. Task types documented: `grep -c "checkpoint:" .claude/skills/ultraplan/references/schemas.md`
5. Validation rules present: `grep "## Validation Rules" .claude/skills/ultraplan/references/schemas.md`
</verification>

<success_criteria>
- [ ] schemas.md documents all YAML frontmatter required fields
- [ ] schemas.md documents all YAML frontmatter optional fields
- [ ] schemas.md documents must_haves block structure
- [ ] schemas.md documents all XML task types (auto, checkpoint:*)
- [ ] schemas.md includes complete examples for both formats
- [ ] schemas.md includes validation rules
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-04-SUMMARY.md`
</output>
